{"version":3,"sources":["index.js"],"names":["modalClose","phoneNumberTextBox","HOST","cleanupModal","setModalLoader","setModalTitle","setModalInputArea","setModalInputPlaceHolder","setModalInputValue","setModalInfoMessage","setModalErrorMessage","openModal","targetElement","callBack","modal","document","querySelector","overlay","modalCloseButton","classList","remove","setTimeout","add","removeEventListener","addEventListener","title","modalTitleNode","innerHTML","getModalUserInput","value","getInputValue","selector","visibility","placeholderString","setAttribute","validatePhoneNumber","phoneNumber","test","error","errorMessage","onSubmitButtonClicked","removeSubmitEventListener","fn","message","messageArea","sendOtp","target","targetInputSelector","id","fetch","then","resp","json","console","log","code","collectOTP","catch","onOTPSubmitCallback","otp","verifyOTP","isSuccessful","currentLocation","params","URL","window","location","searchParams","payload","utm_campaign","get","utm_medium","utm_source","method","headers","body","JSON","stringify","data","user","email","thankUser","collectEmail","token","onEmailSubmitCallback","submitEmail","encodeURIComponent","inputNode","onload","navOpenButton","navLinks","navCloseButton","getAccessButtons","querySelectorAll","forEach","button","e"],"mappings":"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","file":"src.ac1b1299.js","sourceRoot":"..\\src","sourcesContent":["import \"./styles.scss\";\nconst HOST = 'https://stage.savemo.app';\n\nwindow.onload = () => {\n    let navOpenButton = document.querySelector('#navOpenButton');\n    let navLinks = document.querySelector('#navLinks');\n    let navCloseButton = document.querySelector('#navCloseButton');\n\n    let getAccessButtons = document.querySelectorAll('#getAccessHero, #getAccessBanner');\n\n    navOpenButton.addEventListener('click', function () {\n        navOpenButton.setAttribute('aria-expanded', \"true\");\n        navLinks.classList.add('duration-150', 'ease-out')\n        navLinks.classList.remove('hidden');\n        setTimeout(function () {\n            navLinks.classList.add('opacity-100', 'scale-100');\n            navLinks.classList.remove('opacity-0', 'scale-95');\n        }, 2);\n    });\n\n    navCloseButton.addEventListener('click', () => {\n        navOpenButton.setAttribute('aria-expanded', \"false\");\n        navLinks.classList.remove('duration-150', 'ease-out', 'opacity-100', 'scale-100');\n        navLinks.classList.add('duration-100', 'ease-in', 'opacity-0', 'scale-95');\n\n        setTimeout(() => {\n            navLinks.classList.add('hidden');\n        }, 150);\n    });\n\n    getAccessButtons && getAccessButtons.forEach((button) => {\n        button.addEventListener('click', (e) => {\n            openModal(e.target, sendOtp);\n        });\n    });\n};\n\nlet modalClose, phoneNumberTextBox;\n\nfunction cleanupModal () {\n    setModalLoader(false);\n    setModalTitle(false);\n    setModalInputArea(false);\n    setModalInputPlaceHolder(\"\");\n    setModalInputValue(\"\");\n    setModalInfoMessage(\"\");\n    setModalErrorMessage(\"\");\n}\n\nfunction openModal (targetElement, callBack) {\n    let modal = document.querySelector('#modal');\n    let overlay = document.querySelector('#modalOverlay');\n    let modalCloseButton = document.querySelector('#closeModal');\n\n    phoneNumberTextBox = targetElement;\n\n    modal.classList.remove('hidden');\n    overlay.classList.remove('hidden');\n\n    setTimeout(() => {\n        modal.classList.add('duration-150', 'ease-out', 'opacity-100', 'scale-100');\n        overlay.classList.add('duration-150', 'ease-out', 'opacity-80');\n\n        modal.classList.remove('opacity-0', 'scale-95');\n        overlay.classList.remove('opacity-0');\n    }, 2);\n\n    modalClose = () => {\n\n        modal.classList.remove('opacity-100', 'scale-100', 'duration-150', 'ease-out');\n        overlay.classList.remove('opacity-80', 'duration-150', 'ease-out');\n\n        modal.classList.add('duration-100', 'ease-in', 'opacity-0', 'scale-95');\n        overlay.classList.add('duration-100', 'ease-in', 'opacity-0');\n\n        setTimeout(() => {\n            modal.classList.add('hidden');\n            overlay.classList.add('hidden');\n        }, 150);\n\n        cleanupModal();\n\n        modalCloseButton.removeEventListener('click', modalClose);\n    };\n\n    modalCloseButton.addEventListener('click', modalClose);\n\n    callBack && callBack(targetElement);\n\n}\n\nfunction setModalTitle (title) {\n    let modalTitleNode = document.querySelector('#modalTitle');\n    modalTitleNode.innerHTML = title;\n\n    if (title)\n        modalTitleNode.classList.remove('hidden');\n    else\n        modalTitleNode.classList.add('hidden');\n}\n\nfunction getModalUserInput () {\n    return document.querySelector('#userInput').value;\n}\n\nfunction getInputValue (selector) {\n    return document.querySelector(selector)?.value;\n}\n\nfunction setModalLoader (visibility) {\n    if (visibility)\n        document.querySelector('#modalLoader').classList.remove('hidden');\n    else\n        document.querySelector('#modalLoader').classList.add('hidden');\n}\n\nfunction setModalInputPlaceHolder (placeholderString) {\n    document.querySelector(\"#userInput\").setAttribute(\"placeholder\", placeholderString);\n}\n\nfunction validatePhoneNumber (phoneNumber) {\n    return /\\d{10,10}/.test(phoneNumber);\n}\n\nfunction setModalErrorMessage (error) {\n    let errorMessage = document.querySelector('#modalErrorMessage');\n    errorMessage.innerHTML = error;\n\n    if (error)\n        errorMessage.classList.remove('hidden');\n    else\n        errorMessage.classList.add('hidden');\n}\n\nfunction setModalInputArea (visibility) {\n    if (visibility) {\n        document.querySelector('#inputArea').classList.remove('hidden');\n    } else {\n        document.querySelector('#inputArea').classList.add('hidden');\n    }\n}\n\nfunction onSubmitButtonClicked (callBack) {\n    const userInput = document.querySelector('#userInputSubmit');\n    userInput.addEventListener('click', callBack);\n}\n\nfunction removeSubmitEventListener (fn) {\n    const userInput = document.querySelector('#userInputSubmit');\n    userInput.removeEventListener('click', fn);\n}\n\nfunction setModalInputValue (value) {\n    document.querySelector('#userInput').value = value;\n}\n\nfunction setModalInfoMessage (message) {\n    const messageArea = document.querySelector('#modalMessage');\n    messageArea.innerHTML = message;\n\n    if (message) {\n        messageArea.classList.remove('hidden');\n    } else {\n        messageArea.classList.add('hidden');\n    }\n}\n\nfunction sendOtp (target) {\n    const targetInputSelector = `#${target.id}-input`;\n\n    const phoneNumber = getInputValue(targetInputSelector);\n\n    if (!validatePhoneNumber(phoneNumber)) {\n        setModalTitle(\"Please enter a valid phone number and try again\");\n        return\n    }\n\n    setModalLoader(true);\n\n    fetch(`${HOST}/waitlist/send_otp/${phoneNumber}`)\n    .then(resp => resp.json())\n    .then(resp => {\n        setModalLoader(false);\n        console.log(resp);\n\n        if (resp.code === 2000) {\n            collectOTP(phoneNumber);\n\n            return true;\n        } else {\n            setModalErrorMessage(\"Something went wrong from our end. Please try again later\");\n        }\n    })\n    .catch(resp => {\n        setModalLoader(false);\n        setModalErrorMessage(\"Something went wrong. Failed to submit phone number\");\n    });\n}\n\nfunction collectOTP (phoneNumber) {\n    setModalTitle(\"Let's verify your number\");\n    setModalInputArea(true);\n    setModalInputPlaceHolder(\"OTP\");\n\n    const onOTPSubmitCallback = () => {\n        const otp = getModalUserInput();\n\n        if (otp) {\n            verifyOTP(otp, phoneNumber)\n            .then((isSuccessful) => {\n                isSuccessful && removeSubmitEventListener(onOTPSubmitCallback);\n            });\n        } else {\n            setModalErrorMessage(\"Invalid OTP\");\n        }\n    };\n\n    onSubmitButtonClicked(onOTPSubmitCallback);\n}\n\n\nfunction verifyOTP (otp, phoneNumber) {\n    const currentLocation = new URL(window.location);\n    const params = currentLocation.searchParams;\n    const payload = {\n        otp,\n        utm_campaign: params.get('utm_campaign'),\n        utm_medium: params.get('utm_medium'),\n        utm_source: params.get('utm_source')\n    };\n\n    setModalInputArea(false);\n    setModalLoader(true);\n\n    return fetch(`${HOST}/waitlist/${phoneNumber}`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n    })\n    .then(resp => resp.json())\n    .then(resp => {\n        setModalLoader(false);\n\n        console.log(resp);        \n        if (resp.code === 2000) {\n            if (!resp.data?.user?.email) {\n                collectEmail(phoneNumber, resp.data.token);\n            } else {\n                thankUser();\n            }\n            \n            return true;\n        } else {\n            setModalInputArea(true);\n            setModalErrorMessage(\"Invalid OTP\");\n        }\n    })\n    .catch(() => {\n        setModalLoader(false);\n        setModalInputArea(true);\n        setModalErrorMessage(\"Something went wrong while submitting OTP\");\n    });\n}\n\nfunction collectEmail (phoneNumber, token) {\n    setModalTitle(\"Email\");\n    setModalInputArea(true);\n    setModalErrorMessage(\"\");\n    setModalInputValue(\"\");\n\n    setModalInputPlaceHolder(\"Email\");\n\n    const onEmailSubmitCallback = () => {\n        const email = getModalUserInput();\n\n        if (email) {\n            submitEmail(email, phoneNumber, token)\n            .then((isSuccessful) => {\n                isSuccessful && removeSubmitEventListener(onEmailSubmitCallback);\n            });\n        } else {\n            setModalErrorMessage(\"Invalid email\");\n        }\n    };\n\n    onSubmitButtonClicked(onEmailSubmitCallback);\n}\n\nfunction submitEmail (email, phoneNumber, token) {\n    const payload = {\n        token\n    };\n\n    setModalInputArea(false);\n    setModalLoader(true);\n\n    return fetch(`${HOST}/${phoneNumber}/${window.encodeURIComponent(email)}`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n    })\n    .then(resp => resp.json())\n    .then(resp => {\n        setModalLoader(false);\n        if (resp.code === 2000) {\n            thankUser();\n\n            return true;\n        } else {\n            setModalInputArea(true);\n            setModalErrorMessage(\"Error while submitting email\");\n        }\n    })\n    .catch(() => {\n        setModalInputArea(true);\n        setModalLoader(false)\n        setModalErrorMessage(\"Failed to submit email\")\n    });\n}\n\nfunction thankUser () {\n    setModalInputArea(false);\n    setModalErrorMessage(\"\");\n    setModalTitle(\"All done!\");\n    setModalInfoMessage(\"You've been added to the waitlist\");\n\n    setTimeout(() => {\n        if(phoneNumberTextBox) {\n            // Clear phone number after everything is successful\n            const selector = `#${phoneNumberTextBox.id}-input`;\n            const inputNode = document.querySelector(selector);\n\n            if (inputNode) {\n                inputNode.value = \"\";\n            }\n        }\n        modalClose && modalClose();\n    }, 3000);\n}"]}